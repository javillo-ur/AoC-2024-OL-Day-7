Console.WriteLine(File.ReadAllLines("input.txt").Select(line => (long.Parse(line.Split(":")[0].Trim()), line.Split(":")[1].Trim().Split(" ").Select(t => long.Parse(t.Trim())).ToList())).AsParallel().Where(aux => Enumerable.Range(0, aux.Item2.Count-1).Aggregate<int,List<List<int>>>([[]], (curr, it) => curr.SelectMany<List<int>,List<int>>(x => [[..x, 0], [..x, 1], [..x, 2]]).ToList()).Any(op => Enumerable.Range(0, aux.Item2.Count-1).Aggregate((System.Collections.Immutable.ImmutableList.ToImmutableList(aux.Item2.Skip(1)), aux.Item2[0]), (curr, it) => (curr.Item2 > aux.Item1) ? curr : ((op[it] == 0) ? (System.Collections.Immutable.ImmutableList.ToImmutableList(curr.Item1.Skip(1)), curr.Item2 + curr.Item1[0]) : ((op[it] == 2) ? (System.Collections.Immutable.ImmutableList.ToImmutableList(curr.Item1.Skip(1)), long.Parse(curr.Item2.ToString() + curr.Item1[0].ToString())) : (System.Collections.Immutable.ImmutableList.ToImmutableList(curr.Item1.Skip(1)), curr.Item2 * curr.Item1[0])))).Item2 == aux.Item1)).Sum(x => x.Item1));